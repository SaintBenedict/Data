<?xml version="1.0" encoding="utf-8" ?>
<Defs>

  <QuestScriptDef>
    <defName>Util_RandomSelectDiseaseHuman</defName>
    <root Class="QuestNode_GetHediff">
      <storeHediffAs>lodgersDisease</storeHediffAs>
      <storePartsToAffectAs>lodgersDiseasePartsToAffect</storePartsToAffectAs>
      <options>
        <li>
          <def>Flu</def>
        </li>
        <li>
          <def>Plague</def>
        </li>
        <li>
          <def>Malaria</def>
        </li>
        <li>
          <def>SleepingSickness</def>
        </li>
        <li>
          <def>FibrousMechanites</def>
        </li>
        <li>
          <def>SensoryMechanites</def>
        </li>
        <li>
          <def>GutWorms</def>
          <partsToAffect>
            <li>Stomach</li>
          </partsToAffect>
        </li>
        <li>
          <def>MuscleParasites</def>
        </li>
      </options>
    </root>
  </QuestScriptDef>

  <QuestScriptDef>
    <defName>Util_RandomSelectDiseaseAnimal</defName>
    <root Class="QuestNode_GetHediff">
      <storeHediffAs>lodgersDisease</storeHediffAs>
      <storePartsToAffectAs>lodgersDiseasePartsToAffect</storePartsToAffectAs>
      <options>
        <li>
          <def>Animal_Flu</def>
        </li>
        <li>
          <def>Animal_Plague</def>
        </li>
      </options>
    </root>
  </QuestScriptDef>

  <QuestScriptDef>
    <defName>Hospitality_Util_DecideRandomLodgerCount</defName> <!-- Note: Used for human and animal lodgers -->
    <root Class="QuestNode_Sequence">
      <nodes>
        <!-- Determine max lodgers count based on points and rating -->
        <li Class="QuestNode_GetPawnCountByPointsWeighted">
          <storeAs>lodgersCount</storeAs>
          <challengeRating>$challengeRating</challengeRating>
          <maxCountOneStar>6</maxCountOneStar>
          <maxCountTwoStar>10</maxCountTwoStar>
          <maxCountThreeStar>20</maxCountThreeStar>
          <roundRandom>True</roundRandom>
          <pointsCurve>
            <points>
              <li>(100, 1)</li>
              <li>(200, 2)</li>
              <li>(1000, 8)</li>
              <li>(2000, 12)</li>
              <li>(4000, 20)</li>
            </points>
          </pointsCurve>
          <chancesCurve>
            <points>
              <li>(0, 0)</li>
              <li>(1, 7)</li>
              <li>(2, 1)</li>
              <li>(5, 0.75)</li>
              <li>(10, 0.3)</li>
              <li>(20, 0)</li>
            </points>
          </chancesCurve>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

  <QuestScriptDef>
    <defName>Hospitality_Util_AddHealthConditions</defName>
      <root Class="QuestNode_Chance">
        <chance>0.5</chance>
        <!-- Downed -->
        <node Class="QuestNode_Sequence">
          <nodes>
            <li Class="QuestNode_DamageUntilDowned">
              <pawns>$lodgers</pawns>
              <allowBleedingWounds>false</allowBleedingWounds>
            </li>
            <li Class="QuestNode_Set">
              <name>lodgersAreDowned</name>
              <value>true</value>
            </li>
          </nodes>
        </node>
        <!-- Sick -->
        <elseNode Class="QuestNode_Sequence">
          <nodes>
            <li Class="QuestNode_AddHediff">
              <pawns>$lodgers</pawns>
              <hediffDef>$lodgersDisease</hediffDef>
              <partsToAffect>$lodgersDiseasePartsToAffect</partsToAffect>
              <checkDiseaseContractChance>true</checkDiseaseContractChance>
            </li>
            <li Class="QuestNode_Set">
              <name>lodgersAreSick</name>
              <value>true</value>
            </li>
          </nodes>
        </elseNode>
    </root>
  </QuestScriptDef>

  <QuestScriptDef>
    <defName>Util_ChooseRandomQuestLodgerKind</defName>
    <root Class="QuestNode_Sequence">
      <nodes>
        <li Class="QuestNode_IsSet">
          <name>asker</name>
          <node Class="QuestNode_GetRandomPawnKindForFaction">
            <factionOf>$asker</factionOf>
            <storeAs>lodgersPawnKind</storeAs>
            <choices>
              <li>
                <factionDef>Empire</factionDef>
                <pawnKinds>
                  <li>Empire_Common_Lodger</li>
                </pawnKinds>
              </li>
              <li>
                <categoryTag>Tribal</categoryTag>
                <pawnKinds>
                  <li>Tribal_Penitent</li>
                  <li>Tribal_Archer</li>
                  <li>Tribal_Warrior</li>
                </pawnKinds>
              </li>
              <li>
                <categoryTag>Outlander</categoryTag>
                <pawnKinds>
                  <li>SpaceRefugee_Clothed</li>
                  <li>Villager</li>
                </pawnKinds>
              </li>
              <li>
                <factionDef>Pirate</factionDef>
                <pawnKinds>
                  <li>SpaceRefugee_Clothed</li>
                  <li>Mercenary_Gunner_Acidifier</li>
                  <li>Mercenary_Slasher</li>
                </pawnKinds>
              </li>              
            </choices>
            <fallback>SpaceRefugee_Clothed</fallback>
          </node>
          <elseNode Class="QuestNode_GetPawnKind">
            <storeAs>lodgersPawnKind</storeAs>
            <options>
              <li>
                <kindDef>SpaceRefugee_Clothed</kindDef>
                <weight>1</weight>
              </li>
            </options>
          </elseNode>
        </li>
      </nodes>
    </root>
  </QuestScriptDef>

</Defs>